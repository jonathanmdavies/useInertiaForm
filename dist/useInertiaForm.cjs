"use strict";var e=require("react"),t=require("@inertiajs/react"),r=require("lodash"),n=require("axios");const u=()=>{const t=e.createContext(null);return[()=>{const r=e.useContext(t);if(null===r)throw new Error("useContext must be inside a Provider with a value");return r},t.Provider]},s=e=>{const t=structuredClone(e);for(const e in t)r.isPlainObject(t[e])?t[e]=s(t[e]):Array.isArray(t[e])?t[e]=t[e].map((e=>s(e))):void 0!==t[e]&&null!==t[e]||(t[e]="");return t},a=(e,t)=>{Object.entries(e).forEach((([n,u])=>{r.isPlainObject(u)?(o(e,n,`${n}${t}`),a(u,t)):Array.isArray(u)&&o(e,n,`${n}${t}`)}))},o=(e,t,r)=>{t!==r&&(e[r]=e[t],delete e[t])},c=e=>Array.isArray(e)?e:[e],[l,i]=u(),d=(e,t)=>{const r=new Set(e);return r.add(t),r},m=({children:t,model:r,railsAttributes:n})=>{const[u,s]=e.useReducer(d,new Set),a={nestedAttributes:u,addAttribute:s,model:r,railsAttributes:n};return e.createElement(i,{value:a},t)};function f(n,u){const o=e.useCallback((()=>{let e=null,t=n;return"string"==typeof n&&(e=n,t=u),[e,s(t)]}),[n,u]),[i,d]=o(),[m,f]=e.useState(d||{}),[p,b]=i?t.useRemember(d,`${i}:data`):e.useState(d),C=e.useRef();e.useEffect((()=>{const e=p?Object.keys(p):[];1===e.length&&(C.current=e[0])}),[]);const[y,h]=i?t.useRemember({},`${i}:errors`):e.useState({}),[E,g]=e.useState(!1),[k,$]=e.useState(!1),[v,S]=e.useState(),[A,x]=e.useState(!1),[D,I]=e.useState(!1),w=e.useRef(null),R=e.useRef();let O=e.useRef((e=>e));const P=e.useRef();e.useEffect((()=>(P.current=!0,()=>{P.current=!1})),[]);let j=e.useRef(),F=e.useRef();e.useEffect((()=>{j.current&&F.current&&j.current(...F.current)}),[p]);let q=!1;try{const e=l();q=e.railsAttributes}catch(e){}const B=e.useCallback(((e,n,u={})=>{const s={...u,onCancelToken:e=>{if(w.current=e,u.onCancelToken)return u.onCancelToken(e)},onBefore:e=>{if(x(!1),I(!1),clearTimeout(R.current),u.onBefore)return u.onBefore(e)},onStart:e=>{if($(!0),u.onStart)return u.onStart(e)},onProgress:e=>{if(S(e),u.onProgress)return u.onProgress(e)},onSuccess:e=>{if(P.current&&($(!1),S(null),h({}),g(!1),x(!0),I(!0),R.current=setTimeout((()=>{P.current&&I(!1)}),2e3)),u.onSuccess)return u.onSuccess(e)},onError:e=>{if(P.current&&($(!1),S(null),h((e=>{if(!e||!C.current)return e;const t={};return Object.keys(e).forEach((r=>{t[`${C.current}.${r}`]=e[r]})),t})(e)),g(!0)),u.onError)return u.onError(e)},onCancel:()=>{if(P.current&&($(!1),S(null)),u.onCancel)return u.onCancel()},onFinish:e=>{if(P.current&&($(!1),S(null)),w.current=null,u.onFinish)return u.onFinish(e)}};let o=O.current(structuredClone(p));q&&(o=((e,t="_attributes")=>{const n=structuredClone(e);return Object.values(n).forEach((e=>{r.isPlainObject(e)&&a(e,t)})),n})(o)),"delete"===e?t.router.delete(n,{...s,data:o}):t.router[e](n,o,s)}),[p,h]),N=e.useCallback((e=>{if(!e)return void h({});const t=c(e);h((e=>{const r=Object.keys(e).reduce(((r,n)=>({...r,...t.length>0&&!t.includes(String(n))?{[n]:e[n]}:{}})),{});return g(Object.keys(r).length>0),r}))}),[y]);return{data:p,isDirty:!r.isEqual(p,m),errors:y,hasErrors:E,processing:k,progress:v,wasSuccessful:A,recentlySuccessful:D,transform:e.useCallback((e=>{O.current=e}),[]),onChange:e=>{j.current=e},setData:(e,t)=>{if("string"==typeof e)return b((n=>{const u=structuredClone(n);return j.current&&(F.current=[e,t,r.get(n,e)]),r.set(u,e,t),u}));e instanceof Function?b((t=>{const r=e(structuredClone(t));return j.current&&(F.current=[void 0,r,t]),r})):(j.current&&(F.current=[void 0,p,e]),b(e))},getData:e=>r.get(p,e),unsetData:e.useCallback((e=>{b((t=>{const n=structuredClone(t);return j.current&&(F.current=[e,r.get(t,e),void 0]),((e,t)=>{r.unset(e,t);let n=t.indexOf("[");for(;n>=0;){const u=t.slice(0,n),s=r.get(e,u);r.set(e,u,s.filter((e=>e))),n=t.indexOf("[",n+1)}})(n,e),n}))}),[p]),setDefaults:e.useCallback(((e,t)=>{f(void 0!==e?r=>({...r,..."string"==typeof e?{[e]:t}:e}):()=>p)}),[p]),reset:e.useCallback((e=>{if(!e)return j.current&&(F.current=[void 0,m,p]),b(m),void h({});const t=c(e),n=structuredClone(p);t.forEach((e=>{r.set(n,e,r.get(m,e))})),N(e),j.current&&(F.current=[void 0,n,p]),b(n)}),[m,p]),setError:e.useCallback(((e,t)=>{h((r=>{const n={...r,..."string"==typeof e?{[e]:t}:e};return g(Object.keys(n).length>0),n}))}),[y]),getError:e.useCallback((e=>r.get(y,e)),[y]),clearErrors:N,submit:B,get:e.useCallback(((e,t)=>{B("get",e,t)}),[]),post:e.useCallback(((e,t)=>{B("post",e,t)}),[]),put:e.useCallback(((e,t)=>{B("put",e,t)}),[]),patch:e.useCallback(((e,t)=>{B("patch",e,t)}),[]),delete:e.useCallback(((e,t)=>{B("delete",e,t)}),[]),cancel:e.useCallback((()=>{w.current&&w.current.cancel()}),[w.current])}}const[p,b]=(()=>{const t=e.createContext(null);return[()=>{const r=e.useContext(t);if(null===r)throw new Error("useContext must be inside a Provider with a value");return r},t.Provider]})(),C=({children:t,model:u,data:s,method:a="post",to:o,async:c=!1,resetAfterSubmit:l,remember:i=!0,filter:d,onSubmit:m,onChange:p,onSuccess:C,onError:y,...h})=>{const E=e.useCallback((e=>{if(!d)return e;const t=structuredClone(e);return d.forEach((e=>{r.unset(t,e)})),t}),[s,d]),g=i?f(`${a}/${u||o}`,E(s)):f(E(s)),k=e.useCallback((()=>({...g,model:u,method:a,to:o,submit:$})),[s,g.data,g.errors]),$=async e=>{if(!o||!m||!1!==m(k()))return c?n[a](o,g.data):g.submit(a,o,e)};return e.useEffect((()=>{new URL(window.location.href).searchParams.forEach(((e,t)=>{g.setData(t,e)}))}),[]),e.useEffect((()=>{p&&p(k())}),[g.data]),e.useEffect((()=>{y&&y(k())}),[g.errors]),e.createElement(b,{value:k()},e.createElement("form",{onSubmit:e=>{e.preventDefault(),e.stopPropagation(),$({onSuccess:()=>{(l||!1!==l&&!0===c)&&g.reset(),C&&C(k())}})},...h},t))},[y,h]=u(),E=({children:t,model:r})=>{let n=r;try{const e=y();n="["===r.charAt(0)?`${e}${r}`:`${e}.${r}`}catch(e){}const{addAttribute:u}=l();return e.useEffect((()=>{u(r)}),[]),e.createElement(h,{value:n},Array.isArray(t)?t.map(((t,r)=>e.cloneElement(t,{key:r}))):t)},g=(e,t)=>{if(!t)return{inputId:e,inputName:e};let r;return r="["===e.charAt(0)?`${t}${e}`:`${t}.${e}`,{inputId:`${t}_${e}`.replace(".","_").replace(/\[(\d)\]/,"_$1"),inputName:r}},k=({name:e,model:t,errorKey:r,strategy:n=g})=>{const u=p();let s=t??u.model;try{s+=`.${y()}`}catch(e){}const{inputName:a,inputId:o}=n(e,s);return{form:u,inputName:a,inputId:o,value:u.getData(a),setValue:e=>u.setData(a,e),error:u.getError(r??a)}},$=({model:t,emptyData:n})=>{const{setData:u,unsetData:s,getData:a}=p(),{model:o}=l();let c=o??"";try{const e=y();c=o?`${c}.${e}`:e}catch(e){}c=`${c}.${t||""}`;const i=e.useCallback((()=>{u((e=>{const t=structuredClone(e);let u=r.get(t,c);return u&&Array.isArray(u)||(r.set(t,c,[]),u=r.get(t,c)),u.push(n),r.set(t,c,u),t}))}),[]),d=e.useCallback((e=>{const t=a(c);t[e]&&t[e].id?u(`${c}[${e}]._destroy`,!0):s(`${c}[${e}]`)}),[]),m=a(c);return{addInput:i,removeInput:d,paths:e.useCallback((()=>Array.isArray(m)?m.map(((e,r)=>`${t||""}[${r}]`)):[]),[m])()}},v=e.forwardRef((({name:t,component:r="input",model:n,...u},s)=>{const{inputName:a,inputId:o,value:c,setValue:l}=k({name:t,model:n}),i=r;return e.createElement(i,{name:a,id:o,value:c,onChange:e=>l(e.target.value),ref:s,...u})})),S=e.forwardRef((({children:t,type:n="submit",disabled:u=!1,component:s="button",requiredFields:a,...o},c)=>{const{data:l,getData:i,processing:d}=p(),m=e.useCallback((()=>!(!a||0===a.length)&&a.some((e=>{return"string"==typeof(t=i(e))?""===t:"number"==typeof t?0!==t&&!Boolean(t):r.isEmpty(t);var t}))),[l]);return e.createElement(s,{...{children:t,type:n,disabled:u||d||a&&m(),ref:c,...o}})}));var A=e.memo(S);exports.DynamicInputs=({children:t,model:r,emptyData:n,addInputButton:u=e.createElement("button",null,"+"),removeInputButton:s=e.createElement("button",null,"-")})=>{const{addInput:a,removeInput:o,paths:c}=$({model:r,emptyData:n});return e.createElement(e.Fragment,null,e.cloneElement(u,{onClick:a,type:"button"}),c.map(((r,n)=>e.createElement(E,{key:n,model:r},e.createElement("div",null,t),e.cloneElement(s,{onClick:()=>o(n),type:"button"})))))},exports.Form=({children:t,model:r,railsAttributes:n=!1,...u})=>e.createElement(m,{model:r,railsAttributes:n},e.createElement(C,{model:r,...u},t)),exports.Input=v,exports.NestedFields=E,exports.Submit=A,exports.useDynamicInputs=$,exports.useForm=p,exports.useInertiaForm=f,exports.useInertiaInput=k;
//# sourceMappingURL=useInertiaForm.cjs.map
