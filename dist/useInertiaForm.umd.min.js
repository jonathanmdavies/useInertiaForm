!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("@inertiajs/react"),require("lodash"),require("axios")):"function"==typeof define&&define.amd?define(["exports","react","@inertiajs/react","lodash","axios"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).useInertiaForm={},e.React,e["@inertiajs/react"],e._,e.axios)}(this,(function(e,t,r,n,u){"use strict";const s=()=>{const e=t.createContext(null);return[()=>{const r=t.useContext(e);if(null===r)throw new Error("useContext must be inside a Provider with a value");return r},e.Provider]},a=e=>{const t=structuredClone(e);for(const e in t)n.isPlainObject(t[e])?t[e]=a(t[e]):Array.isArray(t[e])?t[e]=t[e].map((e=>a(e))):void 0!==t[e]&&null!==t[e]||(t[e]="");return t},o=(e,t)=>{Object.entries(e).forEach((([r,u])=>{n.isPlainObject(u)?(c(e,r,`${r}${t}`),o(u,t)):Array.isArray(u)&&c(e,r,`${r}${t}`)}))},c=(e,t,r)=>{t!==r&&(e[r]=e[t],delete e[t])},l=e=>Array.isArray(e)?e:[e],[i,d]=s(),m=(e,t)=>{const r=new Set(e);return r.add(t),r},f=({children:e,model:r,railsAttributes:n})=>{const[u,s]=t.useReducer(m,new Set),a={nestedAttributes:u,addAttribute:s,model:r,railsAttributes:n};return t.createElement(d,{value:a},e)};function p(e,u){const s=t.useCallback((()=>{let t=null,r=e;return"string"==typeof e&&(t=e,r=u),[t,a(r)]}),[e,u]),[c,d]=s(),[m,f]=t.useState(d||{}),[p,b]=c?r.useRemember(d,`${c}:data`):t.useState(d),y=t.useRef();t.useEffect((()=>{const e=p?Object.keys(p):[];1===e.length&&(y.current=e[0])}),[]);const[h,C]=c?r.useRemember({},`${c}:errors`):t.useState({}),[g,E]=t.useState(!1),[k,$]=t.useState(!1),[v,S]=t.useState(),[A,D]=t.useState(!1),[I,j]=t.useState(!1),w=t.useRef(null),x=t.useRef();let R=t.useRef((e=>e));const O=t.useRef();t.useEffect((()=>(O.current=!0,()=>{O.current=!1})),[]);let P=t.useRef(),F=t.useRef();t.useEffect((()=>{P.current&&F.current&&P.current(...F.current)}),[p]);let T=!1;try{const e=i();T=e.railsAttributes}catch(e){}const q=t.useCallback(((e,t,u={})=>{const s={...u,onCancelToken:e=>{if(w.current=e,u.onCancelToken)return u.onCancelToken(e)},onBefore:e=>{if(D(!1),j(!1),clearTimeout(x.current),u.onBefore)return u.onBefore(e)},onStart:e=>{if($(!0),u.onStart)return u.onStart(e)},onProgress:e=>{if(S(e),u.onProgress)return u.onProgress(e)},onSuccess:e=>{if(O.current&&($(!1),S(null),C({}),E(!1),D(!0),j(!0),x.current=setTimeout((()=>{O.current&&j(!1)}),2e3)),u.onSuccess)return u.onSuccess(e)},onError:e=>{if(O.current&&($(!1),S(null),C((e=>{if(!e||!y.current)return e;const t={};return Object.keys(e).forEach((r=>{t[`${y.current}.${r}`]=e[r]})),t})(e)),E(!0)),u.onError)return u.onError(e)},onCancel:()=>{if(O.current&&($(!1),S(null)),u.onCancel)return u.onCancel()},onFinish:e=>{if(O.current&&($(!1),S(null)),w.current=null,u.onFinish)return u.onFinish(e)}};let a=R.current(structuredClone(p));T&&(a=((e,t="_attributes")=>{const r=structuredClone(e);return Object.values(r).forEach((e=>{n.isPlainObject(e)&&o(e,t)})),r})(a)),"delete"===e?r.router.delete(t,{...s,data:a}):r.router[e](t,a,s)}),[p,C]),B=t.useCallback((e=>{if(!e)return void C({});const t=l(e);C((e=>{const r=Object.keys(e).reduce(((r,n)=>({...r,...t.length>0&&!t.includes(String(n))?{[n]:e[n]}:{}})),{});return E(Object.keys(r).length>0),r}))}),[h]);return{data:p,isDirty:!n.isEqual(p,m),errors:h,hasErrors:g,processing:k,progress:v,wasSuccessful:A,recentlySuccessful:I,transform:t.useCallback((e=>{R.current=e}),[]),onChange:e=>{P.current=e},setData:(e,t)=>{if("string"==typeof e)return b((r=>{const u=structuredClone(r);return P.current&&(F.current=[e,t,n.get(r,e)]),n.set(u,e,t),u}));e instanceof Function?b((t=>{const r=e(structuredClone(t));return P.current&&(F.current=[void 0,r,t]),r})):(P.current&&(F.current=[void 0,p,e]),b(e))},getData:e=>n.get(p,e),unsetData:t.useCallback((e=>{b((t=>{const r=structuredClone(t);return P.current&&(F.current=[e,n.get(t,e),void 0]),((e,t)=>{n.unset(e,t);let r=t.indexOf("[");for(;r>=0;){const u=t.slice(0,r),s=n.get(e,u);n.set(e,u,s.filter((e=>e))),r=t.indexOf("[",r+1)}})(r,e),r}))}),[p]),setDefaults:t.useCallback(((e,t)=>{f(void 0!==e?r=>({...r,..."string"==typeof e?{[e]:t}:e}):()=>p)}),[p]),reset:t.useCallback((e=>{if(!e)return P.current&&(F.current=[void 0,m,p]),b(m),void C({});const t=l(e),r=structuredClone(p);t.forEach((e=>{n.set(r,e,n.get(m,e))})),B(e),P.current&&(F.current=[void 0,r,p]),b(r)}),[m,p]),setError:t.useCallback(((e,t)=>{C((r=>{const n={...r,..."string"==typeof e?{[e]:t}:e};return E(Object.keys(n).length>0),n}))}),[h]),getError:t.useCallback((e=>n.get(h,e)),[h]),clearErrors:B,submit:q,get:t.useCallback(((e,t)=>{q("get",e,t)}),[]),post:t.useCallback(((e,t)=>{q("post",e,t)}),[]),put:t.useCallback(((e,t)=>{q("put",e,t)}),[]),patch:t.useCallback(((e,t)=>{q("patch",e,t)}),[]),delete:t.useCallback(((e,t)=>{q("delete",e,t)}),[]),cancel:t.useCallback((()=>{w.current&&w.current.cancel()}),[w.current])}}const[b,y]=(()=>{const e=t.createContext(null);return[()=>{const r=t.useContext(e);if(null===r)throw new Error("useContext must be inside a Provider with a value");return r},e.Provider]})(),h=({children:e,model:r,data:s,method:a="post",to:o,async:c=!1,resetAfterSubmit:l,remember:i=!0,filter:d,onSubmit:m,onChange:f,onSuccess:b,onError:h,...C})=>{const g=t.useCallback((e=>{if(!d)return e;const t=structuredClone(e);return d.forEach((e=>{n.unset(t,e)})),t}),[s,d]),E=i?p(`${a}/${r||o}`,g(s)):p(g(s)),k=t.useCallback((()=>({...E,model:r,method:a,to:o,submit:$})),[s,E.data,E.errors]),$=async e=>{if(!o||!m||!1!==m(k()))return c?u[a](o,E.data):E.submit(a,o,e)};return t.useEffect((()=>{new URL(window.location.href).searchParams.forEach(((e,t)=>{E.setData(t,e)}))}),[]),t.useEffect((()=>{f&&f(k())}),[E.data]),t.useEffect((()=>{h&&h(k())}),[E.errors]),t.createElement(y,{value:k()},t.createElement("form",{onSubmit:e=>{e.preventDefault(),e.stopPropagation(),$({onSuccess:()=>{(l||!1!==l&&!0===c)&&E.reset(),b&&b(k())}})},...C},e))},[C,g]=s(),E=({children:e,model:r})=>{let n=r;try{const e=C();n="["===r.charAt(0)?`${e}${r}`:`${e}.${r}`}catch(e){}const{addAttribute:u}=i();return t.useEffect((()=>{u(r)}),[]),t.createElement(g,{value:n},Array.isArray(e)?e.map(((e,r)=>t.cloneElement(e,{key:r}))):e)},k=(e,t)=>{if(!t)return{inputId:e,inputName:e};let r;return r="["===e.charAt(0)?`${t}${e}`:`${t}.${e}`,{inputId:`${t}_${e}`.replace(".","_").replace(/\[(\d)\]/,"_$1"),inputName:r}},$=({name:e,model:t,errorKey:r,strategy:n=k})=>{const u=b();let s=t??u.model;try{s+=`.${C()}`}catch(e){}const{inputName:a,inputId:o}=n(e,s);return{form:u,inputName:a,inputId:o,value:u.getData(a),setValue:e=>u.setData(a,e),error:u.getError(r??a)}},v=({model:e,emptyData:r})=>{const{setData:u,unsetData:s,getData:a}=b(),{model:o}=i();let c=o??"";try{const e=C();c=o?`${c}.${e}`:e}catch(e){}c=`${c}.${e||""}`;const l=t.useCallback((()=>{u((e=>{const t=structuredClone(e);let u=n.get(t,c);return u&&Array.isArray(u)||(n.set(t,c,[]),u=n.get(t,c)),u.push(r),n.set(t,c,u),t}))}),[]),d=t.useCallback((e=>{const t=a(c);t[e]&&t[e].id?u(`${c}[${e}]._destroy`,!0):s(`${c}[${e}]`)}),[]),m=a(c);return{addInput:l,removeInput:d,paths:t.useCallback((()=>Array.isArray(m)?m.map(((t,r)=>`${e||""}[${r}]`)):[]),[m])()}},S=t.forwardRef((({name:e,component:r="input",model:n,...u},s)=>{const{inputName:a,inputId:o,value:c,setValue:l}=$({name:e,model:n}),i=r;return t.createElement(i,{name:a,id:o,value:c,onChange:e=>l(e.target.value),ref:s,...u})})),A=t.forwardRef((({children:e,type:r="submit",disabled:u=!1,component:s="button",requiredFields:a,...o},c)=>{const{data:l,getData:i,processing:d}=b(),m=t.useCallback((()=>!(!a||0===a.length)&&a.some((e=>{return"string"==typeof(t=i(e))?""===t:"number"==typeof t?0!==t&&!Boolean(t):n.isEmpty(t);var t}))),[l]);return t.createElement(s,{...{children:e,type:r,disabled:u||d||a&&m(),ref:c,...o}})}));var D=t.memo(A);e.DynamicInputs=({children:e,model:r,emptyData:n,addInputButton:u=t.createElement("button",null,"+"),removeInputButton:s=t.createElement("button",null,"-")})=>{const{addInput:a,removeInput:o,paths:c}=v({model:r,emptyData:n});return t.createElement(t.Fragment,null,t.cloneElement(u,{onClick:a,type:"button"}),c.map(((r,n)=>t.createElement(E,{key:n,model:r},t.createElement("div",null,e),t.cloneElement(s,{onClick:()=>o(n),type:"button"})))))},e.Form=({children:e,model:r,railsAttributes:n=!1,...u})=>t.createElement(f,{model:r,railsAttributes:n},t.createElement(h,{model:r,...u},e)),e.Input=S,e.NestedFields=E,e.Submit=D,e.useDynamicInputs=v,e.useForm=b,e.useInertiaForm=p,e.useInertiaInput=$}));
//# sourceMappingURL=useInertiaForm.umd.min.js.map
