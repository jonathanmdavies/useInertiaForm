import e,{useReducer as t,useCallback as r,useState as n,useRef as o,useEffect as u}from"react";import{useRemember as c,router as a}from"@inertiajs/react";import{unset as s,get as l,set as i,isPlainObject as d,isEmpty as m,isEqual as f}from"lodash";import p from"axios";const h=()=>{const t=e.createContext(null);return[()=>{const r=e.useContext(t);if(null===r)throw new Error("useContext must be inside a Provider with a value");return r},t.Provider]},y=e=>{const t=structuredClone(e);for(const e in t)d(t[e])?t[e]=y(t[e]):Array.isArray(t[e])?t[e]=t[e].map((e=>y(e))):void 0!==t[e]&&null!==t[e]||(t[e]="");return t},b=(e,t)=>{Object.entries(e).forEach((([r,n])=>{d(n)?(E(e,r,`${r}${t}`),b(n,t)):Array.isArray(n)&&E(e,r,`${r}${t}`)}))},E=(e,t,r)=>{t!==r&&(e[r]=e[t],delete e[t])},g=e=>Array.isArray(e)?e:[e],[$,v]=h(),C=(e,t)=>{const r=new Set(e);return r.add(t),r},A=({children:r,model:n,railsAttributes:o})=>{const[u,c]=t(C,new Set),a={nestedAttributes:u,addAttribute:c,model:n,railsAttributes:o};return e.createElement(v,{value:a},r)};function S(e,t){const m=r((()=>{let r=null,n=e;return"string"==typeof e&&(r=e,n=t),[r,y(n)]}),[e,t]),[p,h]=m(),[E,v]=n(h||{}),[C,A]=p?c(h,`${p}:data`):n(h),S=o();u((()=>{const e=C?Object.keys(C):[];1===e.length&&(S.current=e[0])}),[]);const[D,w]=p?c({},`${p}:errors`):n({}),[k,I]=n(!1),[x,O]=n(!1),[P,j]=n(),[F,B]=n(!1),[N,T]=n(!1),_=o(null),R=o();let V=o((e=>e));const q=o();u((()=>(q.current=!0,()=>{q.current=!1})),[]);let K=o(),L=o();u((()=>{K.current&&L.current&&K.current(...L.current)}),[C]);let U=!1;try{const e=$();U=e.railsAttributes}catch(e){}const z=r(((e,t,r={})=>{const n={...r,onCancelToken:e=>{if(_.current=e,r.onCancelToken)return r.onCancelToken(e)},onBefore:e=>{if(B(!1),T(!1),clearTimeout(R.current),r.onBefore)return r.onBefore(e)},onStart:e=>{if(O(!0),r.onStart)return r.onStart(e)},onProgress:e=>{if(j(e),r.onProgress)return r.onProgress(e)},onSuccess:e=>{if(q.current&&(O(!1),j(null),w({}),I(!1),B(!0),T(!0),R.current=setTimeout((()=>{q.current&&T(!1)}),2e3)),r.onSuccess)return r.onSuccess(e)},onError:e=>{if(q.current&&(O(!1),j(null),w((e=>{if(!e||!S.current)return e;const t={};return Object.keys(e).forEach((r=>{t[`${S.current}.${r}`]=e[r]})),t})(e)),I(!0)),r.onError)return r.onError(e)},onCancel:()=>{if(q.current&&(O(!1),j(null)),r.onCancel)return r.onCancel()},onFinish:e=>{if(q.current&&(O(!1),j(null)),_.current=null,r.onFinish)return r.onFinish(e)}};let o=V.current(structuredClone(C));U&&(o=((e,t="_attributes")=>{const r=structuredClone(e);return Object.values(r).forEach((e=>{d(e)&&b(e,t)})),r})(o)),"delete"===e?a.delete(t,{...n,data:o}):a[e](t,o,n)}),[C,w]),G=r((e=>{if(!e)return void w({});const t=g(e);w((e=>{const r=Object.keys(e).reduce(((r,n)=>({...r,...t.length>0&&!t.includes(String(n))?{[n]:e[n]}:{}})),{});return I(Object.keys(r).length>0),r}))}),[D]);return{data:C,isDirty:!f(C,E),errors:D,hasErrors:k,processing:x,progress:P,wasSuccessful:F,recentlySuccessful:N,transform:r((e=>{V.current=e}),[]),onChange:e=>{K.current=e},setData:(e,t)=>{if("string"==typeof e)return A((r=>{const n=structuredClone(r);return K.current&&(L.current=[e,t,l(r,e)]),i(n,e,t),n}));e instanceof Function?A((t=>{const r=e(structuredClone(t));return K.current&&(L.current=[void 0,r,t]),r})):(K.current&&(L.current=[void 0,C,e]),A(e))},getData:e=>l(C,e),unsetData:r((e=>{A((t=>{const r=structuredClone(t);return K.current&&(L.current=[e,l(t,e),void 0]),((e,t)=>{s(e,t);let r=t.indexOf("[");for(;r>=0;){const n=t.slice(0,r),o=l(e,n);i(e,n,o.filter((e=>e))),r=t.indexOf("[",r+1)}})(r,e),r}))}),[C]),setDefaults:r(((e,t)=>{v(void 0!==e?r=>({...r,..."string"==typeof e?{[e]:t}:e}):()=>C)}),[C]),reset:r((e=>{if(!e)return K.current&&(L.current=[void 0,E,C]),A(E),void w({});const t=g(e),r=structuredClone(C);t.forEach((e=>{i(r,e,l(E,e))})),G(e),K.current&&(L.current=[void 0,r,C]),A(r)}),[E,C]),setError:r(((e,t)=>{w((r=>{const n={...r,..."string"==typeof e?{[e]:t}:e};return I(Object.keys(n).length>0),n}))}),[D]),getError:r((e=>l(D,e)),[D]),clearErrors:G,submit:z,get:r(((e,t)=>{z("get",e,t)}),[]),post:r(((e,t)=>{z("post",e,t)}),[]),put:r(((e,t)=>{z("put",e,t)}),[]),patch:r(((e,t)=>{z("patch",e,t)}),[]),delete:r(((e,t)=>{z("delete",e,t)}),[]),cancel:r((()=>{_.current&&_.current.cancel()}),[_.current])}}const[D,w]=(()=>{const t=e.createContext(null);return[()=>{const r=e.useContext(t);if(null===r)throw new Error("useContext must be inside a Provider with a value");return r},t.Provider]})(),k=({children:t,model:n,data:o,method:c="post",to:a,async:l=!1,resetAfterSubmit:i,remember:d=!0,filter:m,onSubmit:f,onChange:h,onSuccess:y,onError:b,...E})=>{const g=r((e=>{if(!m)return e;const t=structuredClone(e);return m.forEach((e=>{s(t,e)})),t}),[o,m]),$=d?S(`${c}/${n||a}`,g(o)):S(g(o)),v=r((()=>({...$,model:n,method:c,to:a,submit:C})),[o,$.data,$.errors]),C=async e=>{if(!a||!f||!1!==f(v()))return l?p[c](a,$.data):$.submit(c,a,e)};return u((()=>{new URL(window.location.href).searchParams.forEach(((e,t)=>{$.setData(t,e)}))}),[]),u((()=>{h&&h(v())}),[$.data]),u((()=>{b&&b(v())}),[$.errors]),e.createElement(w,{value:v()},e.createElement("form",{onSubmit:e=>{e.preventDefault(),e.stopPropagation(),C({onSuccess:()=>{(i||!1!==i&&!0===l)&&$.reset(),y&&y(v())}})},...E},t))},I=({children:t,model:r,railsAttributes:n=!1,...o})=>e.createElement(A,{model:r,railsAttributes:n},e.createElement(k,{model:r,...o},t)),[x,O]=h(),P=({children:t,model:r})=>{let n=r;try{const e=x();n="["===r.charAt(0)?`${e}${r}`:`${e}.${r}`}catch(e){}const{addAttribute:o}=$();return u((()=>{o(r)}),[]),e.createElement(O,{value:n},Array.isArray(t)?t.map(((t,r)=>e.cloneElement(t,{key:r}))):t)},j=(e,t)=>{if(!t)return{inputId:e,inputName:e};let r;return r="["===e.charAt(0)?`${t}${e}`:`${t}.${e}`,{inputId:`${t}_${e}`.replace(".","_").replace(/\[(\d)\]/,"_$1"),inputName:r}},F=({name:e,model:t,errorKey:r,strategy:n=j})=>{const o=D();let u=t??o.model;try{u+=`.${x()}`}catch(e){}const{inputName:c,inputId:a}=n(e,u);return{form:o,inputName:c,inputId:a,value:o.getData(c),setValue:e=>o.setData(c,e),error:o.getError(r??c)}},B=({model:e,emptyData:t})=>{const{setData:n,unsetData:o,getData:u}=D(),{model:c}=$();let a=c??"";try{const e=x();a=c?`${a}.${e}`:e}catch(e){}a=`${a}.${e||""}`;const s=r((()=>{n((e=>{const r=structuredClone(e);let n=l(r,a);return n&&Array.isArray(n)||(i(r,a,[]),n=l(r,a)),n.push(t),i(r,a,n),r}))}),[]),d=r((e=>{const t=u(a);t[e]&&t[e].id?n(`${a}[${e}]._destroy`,!0):o(`${a}[${e}]`)}),[]),m=u(a);return{addInput:s,removeInput:d,paths:r((()=>Array.isArray(m)?m.map(((t,r)=>`${e||""}[${r}]`)):[]),[m])()}},N=({children:t,model:r,emptyData:n,addInputButton:o=e.createElement("button",null,"+"),removeInputButton:u=e.createElement("button",null,"-")})=>{const{addInput:c,removeInput:a,paths:s}=B({model:r,emptyData:n});return e.createElement(e.Fragment,null,e.cloneElement(o,{onClick:c,type:"button"}),s.map(((r,n)=>e.createElement(P,{key:n,model:r},e.createElement("div",null,t),e.cloneElement(u,{onClick:()=>a(n),type:"button"})))))},T=e.forwardRef((({name:t,component:r="input",model:n,...o},u)=>{const{inputName:c,inputId:a,value:s,setValue:l}=F({name:t,model:n}),i=r;return e.createElement(i,{name:c,id:a,value:s,onChange:e=>l(e.target.value),ref:u,...o})})),_=e.forwardRef((({children:t,type:n="submit",disabled:o=!1,component:u="button",requiredFields:c,...a},s)=>{const{data:l,getData:i,processing:d}=D(),f=r((()=>!(!c||0===c.length)&&c.some((e=>{return"string"==typeof(t=i(e))?""===t:"number"==typeof t?0!==t&&!Boolean(t):m(t);var t}))),[l]);return e.createElement(u,{...{children:t,type:n,disabled:o||d||c&&f(),ref:s,...a}})}));var R=e.memo(_);export{N as DynamicInputs,I as Form,T as Input,P as NestedFields,R as Submit,B as useDynamicInputs,D as useForm,S as useInertiaForm,F as useInertiaInput};
//# sourceMappingURL=useInertiaForm.js.map
